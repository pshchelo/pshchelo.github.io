
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://pshchelo.github.io/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="https://pshchelo.github.io/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="https://pshchelo.github.io/theme/pygments/solarized-light.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="https://pshchelo.github.io/theme/pygments/solarized-light.min.css">


  <link rel="stylesheet" type="text/css" href="https://pshchelo.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://pshchelo.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://pshchelo.github.io/theme/font-awesome/css/solid.css">


    <link href="https://pshchelo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Bits and Pieces Atom">


    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">



<meta name="author" content="pshchelo" />
<meta name="description" content="setting up dualbooted HP notebook in UEFI mode" />
<meta name="keywords" content="hp, dualboot, uefi">


<meta property="og:site_name" content="Bits and Pieces"/>
<meta property="og:title" content="UEFI boot order on dualbooted HP EliteBook 840"/>
<meta property="og:description" content="setting up dualbooted HP notebook in UEFI mode"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://pshchelo.github.io/uefi-boot-hp.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2014-04-14 00:00:00+03:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://pshchelo.github.io/author/pshchelo.html">
<meta property="article:section" content="work"/>
<meta property="article:tag" content="hp"/>
<meta property="article:tag" content="dualboot"/>
<meta property="article:tag" content="uefi"/>
<meta property="og:image" content="/images/avatar.jpg">

  <title>Bits and Pieces &ndash; UEFI boot order on dualbooted HP EliteBook 840</title>

</head>
<body >
  <aside>
    <div>
      <a href="https://pshchelo.github.io">
        <img src="/images/avatar.jpg" alt="" title="">
      </a>

      <h1>
        <a href="https://pshchelo.github.io"></a>
      </h1>



      <nav>
        <ul class="list">


              <li>
                <a target="_self"
                   href="https://pshchelo.github.io/pages/about-me.html#about-me">
                  About Me
                </a>
              </li>

            <li>
              <a target="_self" href="http://python.org/" >Python</a>
            </li>
            <li>
              <a target="_self" href="http://www.openstack.org/" >OpenStack</a>
            </li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/pshchelo" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-bitbucket" href="https://bitbucket.org/pshchelo" target="_blank">
              <i class="fab fa-bitbucket"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/pshchelo" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/pshchelo" target="_blank">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="https://pshchelo.github.io">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://pshchelo.github.io/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="uefi-boot-hp">UEFI boot order on dualbooted HP EliteBook 840</h1>
    <p>
      Posted on Mon 14 April 2014 in <a href="https://pshchelo.github.io/category/work.html">work</a>

    </p>
  </header>


  <div>
    <div class="section" id="problem">
<h2>Problem</h2>
<p>Using UEFI+SecureBoot, dual boot Windows 8.1 / Ubuntu 13.10. Boot order
can be configured in BIOS per device (HDD/ODD/PXI/USB etc) but there is
no way to specify boot order of systems present on HDD. UEFI boot loader
finds both Windows (present as <tt class="docutils literal">OS Manager</tt>) and Ubuntu (as
<tt class="docutils literal">ubuntu</tt>), but always uses <tt class="docutils literal">OS Manager</tt> first. As I intend to use
Ubuntu most of the time, I need a way to make booting Ubuntu the default
option.</p>
</div>
<div class="section" id="research">
<h2>Research</h2>
<p>According to <em>teh Internets</em> such problems seem to occur reasonably
often, when vendors &quot;under-implement&quot; UEFI on their products. One
commonly proposed solution is using recent versions of <tt class="docutils literal"><span class="pre">boot-repair</span></tt>
Ubuntu package (a really nice piece of engineering, saved my ass couple
of times in the past). What it does is it substitutes (with backup of
course) the windows <em>efi</em> file with accordingly renamed Ubuntu <em>efi</em>
file, thus loading GRUB automatically, and from there user can choose
what system to boot. But I find such solution a bit too risky, so I want
something more native.</p>
<p>Another program that is related is <tt class="docutils literal">efibootmgr</tt></p>
<pre class="literal-block">
sudo apt-get install efibootmgr
</pre>
<p>It has the option to modify boot order of <em>efi</em> files with
<tt class="docutils literal">efibootmgr <span class="pre">-o</span></tt>, but at least on my particular HP notebook it has no
effect, and system boots to Windows by default despite any changes in
the boot order introduced by <tt class="docutils literal">efibootmgr</tt>. Strangely though, the
option to force the boot order only on next reboot (<tt class="docutils literal">efibootmgr <span class="pre">-n</span></tt>)
is working alright. So, here comes the solution I figured out with the
help of <a class="reference external" href="http://ubuntuforums.org/showthread.php?t=2173267">this Ubuntu Forums
thread</a></p>
</div>
<div class="section" id="solution">
<h2>Solution</h2>
<p>My current EFI setup looks like following</p>
<pre class="literal-block">
shell$: sudo efibootmgr
BootCurrent: 0001
Timeout: 0 seconds
BootOrder: 0001,0002
Boot0001* ubuntu
Boot0002* Windows Boot Manager
</pre>
<p>So I 've placed the following line in <tt class="docutils literal">/etc/rc.local</tt> (before the
final <tt class="docutils literal">exit 0</tt> line):</p>
<pre class="literal-block">
/bin/efibootmgr -n 0001
</pre>
<p>This forces next default boot to be Ubuntu on every boot of Ubuntu. The
dark side - after booting to Windows, this setting naturally disappears,
so the next booted by default system after Windows boot is Windows
again. But actually this is <strong>exactly what I want</strong> - it sort of
replicates <tt class="docutils literal">GRUB_SAVE_DEFAULT</tt> feature which I was always using
before, so that every next boot by default is the same as previous boot.
Installing zero delay on UEFI bootloader (there is still couple of
seconds to press F9 and go into UEFI boot menu manually), and very short
delay on GRUB (2 sec just for an emergency need to boot not into
standard Ubuntu) gives me a system that's fast enough to boot in
unattended mode.</p>
</div>
<div class="section" id="update">
<h2>Update</h2>
<p>After living with this configuration for several months I realized two things:</p>
<ol class="arabic simple">
<li>I do not use Windows more than once a month;</li>
<li>Using hibernate via TuxOnIce has some problems.</li>
</ol>
<p>The last one is due to rc.local not being processed on resume from hibernate,
and unfortunately I failed to configure TuxOnIce to execute the <tt class="docutils literal">efibootmgr</tt>
properly on resume.</p>
<p>I again turned to BIOS settings and this time noticed that I can
in fact configure &quot;Custom&quot; boot section and make it the first one to boot.
So now I have Ubuntu booting by default, and from Grub I can start Windows
if I need, and also I can safely use SAVE_DEFAULT option of Grub.
For those times when Windows <em>has</em> to be booted directly from EFI,
there is still possibility to override first boot option during POST.</p>
</div>

  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://pshchelo.github.io/tag/hp.html">hp</a>
      <a href="https://pshchelo.github.io/tag/dualboot.html">dualboot</a>
      <a href="https://pshchelo.github.io/tag/uefi.html">uefi</a>
    </p>
  </div>





<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'pshchelo';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy; 2024 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://pshchelo.github.io/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Bits and Pieces ",
  "url" : "https://pshchelo.github.io",
  "image": "/images/avatar.jpg",
  "description": ""
}
</script>
<a href="https://github.com/pshchelo/pshchelo.github.io" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>
</html>