<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Bits and Pieces - drac</title>
        <link rel="stylesheet" href="https://pshchelo.github.io/theme/css/main.css" />
        <link href="https://pshchelo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Bits and Pieces Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://pshchelo.github.io/">Bits and Pieces </a></h1>
                <nav><ul>
                    <li><a href="https://pshchelo.github.io/pages/about-me.html">About&nbsp;Me</a></li>
                    <li><a href="https://pshchelo.github.io/category/play.html">play</a></li>
                    <li><a href="https://pshchelo.github.io/category/work.html">work</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://pshchelo.github.io/vnc-in-ironic.html">Graphical <span class="caps">VNC</span> console in ironic - early&nbsp;prototype</a></h1>
<footer class="post-info">
        <abbr class="published" title="2016-12-12T00:00:00+02:00">
                Published: Mon 12 December 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://pshchelo.github.io/author/pshchelo.html">pshchelo</a>
        </address>
<p>In <a href="https://pshchelo.github.io/category/work.html">work</a>.</p>
<p>tags: <a href="https://pshchelo.github.io/tag/ironic.html">ironic</a> <a href="https://pshchelo.github.io/tag/vnc.html">vnc</a> <a href="https://pshchelo.github.io/tag/drac.html">drac</a> </p>
</footer><!-- /.post-info --><p>In integrated case (working as part of OpenStack deployment) nova instances
deployed on ironic baremetal nodes have certain limitations compared to
standard virtual machines created by nova.
In particular it is not currently possible to access the graphical console
of such instance for example via horizon&nbsp;Dashboard.</p>
<p>This is about to change with ironic community starting to work <a class="footnote-reference" href="#id6" id="id1">[1]</a>
on introducing a framework for graphical console access for baremetal nodes.
As each hardware vendor implements a different way to provide graphical
console access, the framework is planned to be quite generic,
leaving details of actual graphical console configuration and management
to a proposed GraphicalConsole interface of an ironic&nbsp;driver.</p>
<p>One interesting hardware to consider in this regard is Dell servers supporting
iDRACv7 or newer <a class="footnote-reference" href="#id7" id="id2">[2]</a>.
The iDRAC firmware on such servers supports native access to the server’s
graphical console over OpenVNC-compatible protocol directly,
without a need of proprietary <span class="caps">VNC</span> proxies or clients.
An administrator who has appropriate access to the iDRAC configuration can
enable this built-in <span class="caps">VNC</span> server and set the password, connection timeout and
<span class="caps">SSL</span> encryption&nbsp;options.</p>
<p>In order to test the <span class="caps">VNC</span> capabilities of such hardware I have implemented
a prototype <a class="footnote-reference" href="#id8" id="id3">[3]</a> of a graphical console interface for the <span class="caps">DRAC</span> driver.
It uses <span class="caps">WS</span>-<span class="caps">MAN</span> <span class="caps">HTTP</span> <span class="caps">API</span> (as the rest of <span class="caps">DRAC</span>-specific driver interfaces)
to toggle the <span class="caps">VNC</span> server feature on and off and set its properties.
I have also created a prototype <a class="footnote-reference" href="#id9" id="id4">[4]</a> of <tt class="docutils literal">get_vnc_console</tt> method for ironic
virt-driver in nova.
As a result, I was able to get access to the graphical console in
horizon Dashboard for the nova instance deployed on top of Dell R630 server
managed by&nbsp;ironic.</p>
<img alt="Screenshot of a VNC console of the baremetal node in horizon Dashboard" class="align-center" src="https://pshchelo.github.io/images/ironic-vnc-console-files/bm-vnc-console-in-horizon.png" style="width: 100%;" />
<div class="section" id="lessons-learned">
<h2>Lessons&nbsp;learned</h2>
<p>Of course no prototype is complete and without any bugs/problems discovered
during testing.
Here is what I’ve been hitting my head and hacking around while making
this to&nbsp;work:</p>
<div class="section" id="prototype-limitations">
<h3>Prototype&nbsp;limitations</h3>
<ul>
<li><p class="first">This prototype is done prior to the generic graphical console framework
implementation done in ironic.
Thus the prototype implementation is for now overriding the existing serial
console interface in a specifically created for this purpose ironic driver.
That means currently it is not possible to have both serial console
and graphical&nbsp;console.</p>
<p>Conveniently though, the proposed base GraphicalConsole interface will have
the same <span class="caps">API</span> as the current Console (SerialConsole in the future) interface.
This means that once the generic framework for graphical console interfaces
is implemented in ironic, this prototype can be plugged as graphical
console interface basically&nbsp;as-is.</p>
</li>
<li><p class="first">The interface implementation is using low-level <span class="caps">WS</span>-<span class="caps">MAN</span> Python client calls
for now since support for managing iDracCardService is yet lacking
from python-dracclient.
The work to enable this functionality is already ongoing in the community&nbsp;though.</p>
</li>
<li><p class="first">The ironic virt-driver changes are rather specific for this particular case
to let me quickly test this functionality.
It will be changed after the generic graphical console is implemented in
Ironic and required complementary functionality is available in&nbsp;python-ironicclient.</p>
</li>
</ul>
</div>
<div class="section" id="idrac-vnc-limitations">
<h3>iDrac <span class="caps">VNC</span>&nbsp;limitations</h3>
<ul class="simple">
<li>OpenVNC implementation in iDRAC does not seem to be complete as noVNC can
not properly connect to it resulting in an apparently connected console
with no graphical output <a class="footnote-reference" href="#id10" id="id5">[5]</a>.
A single passed encoding parameter must be disabled in noVNC code.
I had to resort to noVNC patched accordingly, but the implications of such
patch on access to standard <span class="caps">VM</span> graphical console are yet to be&nbsp;tested.</li>
<li>Password must be set on the <span class="caps">VNC</span> server as noVNC can not connect to it
otherwise.
It seems setting the password for the iDRAC <span class="caps">VNC</span> server to None/empty string
still results in <span class="caps">VNC</span> server requesting a password on connection,
but noVNC can not accept an empty password in its password prompt.
I am not sure if this should be considered a bug in iDRAC <span class="caps">VNC</span> server or
in&nbsp;noVNC.</li>
<li>I have not tested yet how iDRAC <span class="caps">VNC</span> server works with noVNC when <span class="caps">SSL</span> is
enabled in iDRAC <span class="caps">VNC</span>&nbsp;Server.</li>
<li>The iDRAC <span class="caps">VNC</span> server is limited to a single <span class="caps">VNC</span> session at a time,
so it is not really multi-user setup.
On the other hand this still might suffice for undercloud-like use cases
such as&nbsp;TrippleO.</li>
<li>Note that in the current prototype, all nodes running nova-novncproxy
service (or the single one specified as <tt class="docutils literal">vncserver_proxyclient_address</tt>
in config for nova-compute with ironic virt-driver) must effectively have
access to the <span class="caps">BMC</span> network as the built-in iDRAC <span class="caps">VNC</span> server is serving from
its own <span class="caps">BMC</span> <span class="caps">IP</span> address.
Care has to be taken to setup such proxying securely in a clustered nova&nbsp;deployment.</li>
</ul>
<p>Nevertheless, this seems like an interesting and promising development on
the hardware market.
I consider it as yet another small step on the way forward to close the gap
between baremetal and virtual servers in OpenStack and enable a unified user
experience for compute&nbsp;service.</p>
</div>
<div class="section" id="references">
<h3>References</h3>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://review.openstack.org/#/c/306074/">https://review.openstack.org/#/c/306074/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://en.community.dell.com/cfs-file/__key/telligent-evolution-components-attachments/13-4491-00-00-20-44-10-34/AccessingRemoteDesktop_5F00_using_5F00_VNC_5F00_on_5F00_iDRAC.pdf">http://en.community.dell.com/cfs-file/__key/telligent-evolution-components-attachments/13-4491-00-00-20-44-10-34/AccessingRemoteDesktop_5F00_using_5F00_VNC_5F00_on_5F00_iDRAC.pdf</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="https://review.openstack.org/#/c/396661/">https://review.openstack.org/#/c/396661/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="https://review.openstack.org/#/c/398270/">https://review.openstack.org/#/c/398270/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="https://github.com/kanaka/noVNC/issues/712">https://github.com/kanaka/noVNC/issues/712</a></td></tr>
</tbody>
</table>
</div>
</div>
<p>There are <a href="https://pshchelo.github.io/vnc-in-ironic.html#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://www.openstack.org/">OpenStack</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>Contacts</h2>
                        <ul>
                            <li><a href="https://pshchelo.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://github.com/pshchelo">GitHub</a></li>
                            <li><a href="https://bitbucket.org/pshchelo">BitBucket</a></li>
                            <li><a href="https://twitter.com/pshchelo">Twitter</a></li>
                            <li><a href="https://www.linkedin.com/in/pshchelo">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'pshchelo';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>